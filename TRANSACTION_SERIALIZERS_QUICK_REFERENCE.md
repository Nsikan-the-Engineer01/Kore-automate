# Transaction Serializers Quick Reference

**Date:** January 29, 2026  
**Status:** âœ… Production Ready

---

## Quick Overview

Two serializers for Transaction API:
- **TransactionListSerializer** - List views, optimized fields
- **TransactionDetailSerializer** - Detail views, all fields read-only

Both serialize Decimal amounts as strings and provide computed "title" field.

---

## Basic Usage

### Import
```python
from core_apps.transactions.serializers import (
    TransactionListSerializer,
    TransactionDetailSerializer
)
```

### List View
```python
class TransactionListView(generics.ListAPIView):
    queryset = Transaction.objects.select_related('goal', 'collection')
    serializer_class = TransactionListSerializer
```

### Detail View
```python
class TransactionDetailView(generics.RetrieveAPIView):
    queryset = Transaction.objects.select_related('goal', 'collection')
    serializer_class = TransactionDetailSerializer
```

### ViewSet
```python
class TransactionViewSet(viewsets.ReadOnlyModelViewSet):
    queryset = Transaction.objects.select_related('goal', 'collection')
    
    def get_serializer_class(self):
        if self.action == 'retrieve':
            return TransactionDetailSerializer
        return TransactionListSerializer
```

---

## TransactionListSerializer Fields

```json
{
  "id": "550e8400-...",                    // UUID, read-only
  "type": "CREDIT",                        // DEBIT, CREDIT, or FEE
  "amount": "100000.00",                   // Decimal as string
  "currency": "NGN",                       // 3-letter code
  "status": "SUCCESS",                     // PENDING, SUCCESS, FAILED
  "title": "Credit",                       // Computed: "Credit", "Debit", "Kore Fee"
  "goal": {                                // Nested: null if not set
    "id": "660e8400-...",
    "name": "Emergency Fund"
  },
  "collection": {                          // Nested: null if not set
    "id": "770e8400-..."
  },
  "request_ref": "req_12345",              // Request identifier
  "provider_ref": "prov_67890",            // Provider ref, null if none
  "occurred_at": "2026-01-29T10:30:00Z",   // When it happened
  "created_at": "2026-01-29T10:30:00Z",    // Record created
  "updated_at": "2026-01-29T15:45:00Z",    // Last updated
  "metadata": {                            // Additional data
    "source": "mobile_app"
  }
}
```

---

## TransactionDetailSerializer

Same fields as TransactionListSerializer, but all fields are **read-only**.

**All detail fields:**
- id, type, amount, currency, status, title
- goal, collection
- request_ref, provider_ref
- occurred_at, created_at, updated_at
- metadata

---

## Decimal/Amount Handling

**Always serialized as string:**
```python
# Model: Decimal('100000.00')
# Serialized: "100000.00"
# Frontend: Use string, don't parse to float
```

**Why string?**
- Exact precision (no floating-point errors)
- Works in JavaScript without loss
- Financial industry standard

---

## Computed "title" Field

Converts type to friendly label:

| type | title |
|------|-------|
| CREDIT | "Credit" |
| DEBIT | "Debit" |
| FEE | "Kore Fee" |

**Usage:** Display in UI without client-side mapping
```python
# Auto-generated by serializer
data['title']  # "Credit", "Debit", or "Kore Fee"
```

---

## Nested Objects

### goal (nullable)
```python
# When goal is set:
"goal": {
  "id": "660e8400-...",
  "name": "Emergency Fund"
}

# When goal is null:
"goal": null
```

### collection (nullable)
```python
# When collection is set:
"collection": {
  "id": "770e8400-..."
}

# When collection is null:
"collection": null
```

---

## Transaction Types

```
CREDIT  â†’ "Credit"    (deposit/contribution)
DEBIT   â†’ "Debit"     (withdrawal)
FEE     â†’ "Kore Fee"  (service fee)
```

---

## Transaction Statuses

```
PENDING â†’ Processing
SUCCESS â†’ Completed
FAILED  â†’ Error/Rejected
```

---

## Read-Only Fields

**TransactionListSerializer:**
- id
- created_at
- updated_at

**TransactionDetailSerializer:**
- All fields (append-only ledger)

---

## Performance Tips

### Use select_related()
```python
# Good (1 query)
transactions = Transaction.objects.select_related('goal', 'collection')
serializer = TransactionListSerializer(transactions, many=True)

# Bad (N+1 queries)
transactions = Transaction.objects.all()
serializer = TransactionListSerializer(transactions, many=True)
```

### Use pagination
```python
# For large lists
pagination_class = PageNumberPagination
page_size = 25
```

---

## Common Queries

### By goal
```python
goal_txns = Transaction.objects.filter(goal_id=goal_id)
```

### By status
```python
success = Transaction.objects.filter(status='SUCCESS')
pending = Transaction.objects.filter(status='PENDING')
```

### By type
```python
credits = Transaction.objects.filter(type='CREDIT')
debits = Transaction.objects.filter(type='DEBIT')
fees = Transaction.objects.filter(type='FEE')
```

### Sum by type
```python
credit_sum = Transaction.objects.filter(
    type='CREDIT', status='SUCCESS'
).aggregate(Sum('amount'))['amount__sum'] or Decimal('0.00')
```

---

## Testing

```bash
# Run all tests
python manage.py test core_apps.transactions.tests_serializers -v 2

# Run list serializer tests
python manage.py test core_apps.transactions.tests_serializers.TransactionListSerializerTestCase -v 2

# Run detail serializer tests
python manage.py test core_apps.transactions.tests_serializers.TransactionDetailSerializerTestCase -v 2
```

**Test Coverage:** 40+ test cases
- âœ… All fields present
- âœ… Decimal handling
- âœ… Title computation
- âœ… Nested objects
- âœ… Null handling
- âœ… Edge cases

---

## Example API Responses

### List Endpoint
```bash
GET /api/v1/transactions/?goal_id=550e8400-...
```

Response (200 OK):
```json
{
  "count": 3,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": "550e8400-...",
      "type": "CREDIT",
      "amount": "100000.00",
      "currency": "NGN",
      "status": "SUCCESS",
      "title": "Credit",
      "goal": {
        "id": "660e8400-...",
        "name": "Emergency Fund"
      },
      "collection": null,
      "request_ref": "req_12345",
      "provider_ref": "prov_67890",
      "occurred_at": "2026-01-29T10:30:00Z",
      "created_at": "2026-01-29T10:30:00Z",
      "updated_at": "2026-01-29T15:45:00Z",
      "metadata": {"source": "mobile_app"}
    },
    {
      "id": "551e8400-...",
      "type": "FEE",
      "amount": "500.00",
      "currency": "NGN",
      "status": "SUCCESS",
      "title": "Kore Fee",
      "goal": {
        "id": "660e8400-...",
        "name": "Emergency Fund"
      },
      "collection": null,
      "request_ref": "req_fee_001",
      "provider_ref": null,
      "occurred_at": "2026-01-29T10:31:00Z",
      "created_at": "2026-01-29T10:31:00Z",
      "updated_at": "2026-01-29T10:31:00Z",
      "metadata": {}
    }
  ]
}
```

### Detail Endpoint
```bash
GET /api/v1/transactions/550e8400-...
```

Response (200 OK):
```json
{
  "id": "550e8400-...",
  "type": "CREDIT",
  "amount": "100000.00",
  "currency": "NGN",
  "status": "SUCCESS",
  "title": "Credit",
  "goal": {
    "id": "660e8400-...",
    "name": "Emergency Fund"
  },
  "collection": null,
  "request_ref": "req_12345",
  "provider_ref": "prov_67890",
  "occurred_at": "2026-01-29T10:30:00Z",
  "created_at": "2026-01-29T10:30:00Z",
  "updated_at": "2026-01-29T15:45:00Z",
  "metadata": {
    "source": "mobile_app",
    "ip": "192.168.1.1"
  }
}
```

---

## Troubleshooting

| Problem | Cause | Solution |
|---------|-------|----------|
| Amount is float | Using raw model | Use serializer |
| Goal data missing | No select_related() | Add `select_related('goal', 'collection')` |
| Precision lost | Parsing to JS number | Keep as string |
| Title not showing | Not using serializer | Use TransactionListSerializer |
| N+1 queries | No optimization | Use `select_related()` |

---

## Related Files

- **Serializers:** [core_apps/transactions/serializers.py](core_apps/transactions/serializers.py)
- **Tests:** [core_apps/transactions/tests_serializers.py](core_apps/transactions/tests_serializers.py)
- **Model:** [core_apps/transactions/models.py](core_apps/transactions/models.py)
- **Full Docs:** [TRANSACTION_SERIALIZERS_DOCUMENTATION.md](TRANSACTION_SERIALIZERS_DOCUMENTATION.md)

---

## Cheat Sheet

```python
# Import
from core_apps.transactions.serializers import (
    TransactionListSerializer,
    TransactionDetailSerializer
)

# Use in view
queryset = Transaction.objects.select_related('goal', 'collection')
serializer_class = TransactionListSerializer

# Serialize single
transaction = Transaction.objects.get(id=id)
data = TransactionDetailSerializer(transaction).data

# Serialize many
transactions = Transaction.objects.all()
data = TransactionListSerializer(transactions, many=True).data

# With pagination
from rest_framework.pagination import PageNumberPagination
page = PageNumberPagination()
page.page_size = 25
```

---

**Status:** ðŸš€ **READY FOR PRODUCTION**
